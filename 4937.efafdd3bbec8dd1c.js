"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4937],{4937:(y,f,u)=>{u.d(f,{n:()=>c});var b=u(5861),i=u(5439),a=u(7815),Z=u(3594),e=u(6738),h=u(2485),T=u(4338),l=u(3497),n=u(6895),p=u(4006);function o(d,_){if(1&d&&(e.TgZ(0,"ion-row")(1,"ion-col",20)(2,"ion-label")(3,"ion-text",21),e._uU(4),e.qZA()()(),e.TgZ(5,"ion-col",22)(6,"ion-label")(7,"ion-text",21),e._uU(8),e.qZA(),e.TgZ(9,"ion-text")(10,"ion-note"),e._uU(11),e.qZA()()()()()),2&d){const t=_.$implicit;e.xp6(4),e.Oqu(t.prodName),e.xp6(4),e.hij("",t.qty," "),e.xp6(3),e.Oqu(t.unit)}}function r(d,_){if(1&d&&(e.TgZ(0,"ion-label"),e._UZ(1,"ion-icon",23),e.TgZ(2,"ion-text"),e._uU(3),e.qZA(),e._UZ(4,"br"),e.qZA()),2&d){const t=_.$implicit;e.xp6(3),e.Oqu(t.desc)}}let c=(()=>{class d{constructor(t,s,m,g,A,O,P){this.route=t,this.api=s,this.rout=m,this.loadingController=g,this.toast=A,this.actionSheetCtl=O,this.modalController=P,this.agreeTerms=!1,this.balanceLoding=!1,this.route.queryParams.subscribe(U=>{U&&U.user_info&&U.mzd&&(this.USER_INFO=JSON.parse(U.user_info),this.mzd=JSON.parse(U.mzd))})}ngOnInit(){this.getWalletBalance()}presentLoadingWithOptions(t){var s=this;return(0,b.Z)(function*(){const m=yield s.loadingController.create({spinner:"bubbles",mode:"ios",duration:5e3,message:t,translucent:!0,backdropDismiss:!1});yield m.present(),yield m.onDidDismiss()})()}closeModal(){var t=this;return(0,b.Z)(function*(){t.modalController.dismiss(),yield t.modalController.dismiss(t.mzd,"cancel")})()}agreeCheck(t){}handleErrorGetBalance(t){this.presentToast("\u062d\u062f\u062b \u062e\u0637\u0623 \u0645\u0627 \u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u0644\u0645\u062d\u0627\u0648\u0644\u0629 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")}prepareActonSheet(){this.presentLoadingWithOptions(),this.api.getBalance(this.USER_INFO._id).subscribe(t=>{this.walletBalance=+t.transaction[0].balance,this.loadingController.dismiss(),this.presentActionSheet()},t=>{this.loadingController.dismiss(),this.handleErrorGetBalance(t)},()=>{})}getWalletBalance(){this.api.getBalance(this.USER_INFO._id).subscribe(t=>{this.walletBalance=+t.transaction[0].balance},t=>{this.handleErrorGetBalance(t)},()=>{})}validate(){return 0==this.agreeTerms?(this.presentToast("\u0627\u0644\u0631\u062c\u0627\u0621 \u0642\u0631\u0627\u0621\u0629 \u0627\u0644\u0634\u0631\u0648\u0637 \u0648\u0627\u0644\u0625\u062a\u0641\u0627\u0642\u064a\u0629 \u0648\u0627\u0644\u0645\u0648\u0627\u0641\u0642\u0629 \u0639\u0644\u064a\u0647\u0627","danger"),!1):this.walletBalance<+this.mzd.deposite+ +this.mzd.fee?(this.presentToast("\u0631\u0635\u064a\u062f\u0643 \u063a\u064a\u0631 \u0643\u0627\u0641\u064a , \u0627\u0644\u0631\u062c\u0627\u0621 \u0634\u062d\u0646 \u0645\u062d\u0641\u0638\u062a\u0643","danger"),!1):!(this.checkRemainTime()<=6e4&&(this.presentToast("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0627\u0644\u0625\u0634\u062a\u0631\u0627\u0643 , \u0644\u0642\u062f \u0628\u062f\u0623 \u0627\u0644\u0645\u0632\u0627\u062f \u0628\u0627\u0644\u0641\u0639\u0644","danger"),1))}checkRemainTime(){let t=i(this.mzd.start),s=new Date;return i(t).diff(i(s))}prepareUserbj(t){return t?{_id:this.mzd._id,user:[{userId:this.USER_INFO._id,cancel:0,cancelTime:null,reason:"",cancelTransId:""}]}:{_id:this.mzd._id,user:[{userId:this.USER_INFO._id,status:1,time:new Date,cancel:0,cancelTime:"",reason:"",transactionId:""}]}}subescribe(){1==this.validate()&&(this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u0645\u0639\u0627\u0644\u062c\u0629 \u0637\u0644\u0628\u0643 .."),this.api.updateAuctionUsers(this.prepareUserbj()).subscribe(t=>{this.mzd.users=t.updatedAuctionUsers.users,this.presentToast("\u062a\u0645 \u0627\u0644\u0625\u0634\u062a\u0631\u0627\u0643 \u0628\u0646\u062c\u0627\u062d ","success"),this.modalController.dismiss(this.mzd,"done")},t=>{this.loadingController.dismiss(),this.handleError(t.error.error)},()=>{this.loadingController.dismiss()}))}reSubiscribtion(){1==this.validate()&&(this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u0645\u0639\u0627\u0644\u062c\u0629 \u0637\u0644\u0628\u0643 .."),this.api.resubiscribeAuctionUsers(this.prepareUserbj("resubiscr")).subscribe(t=>{this.presentToast("\u062a\u0645 \u0627\u0644\u0625\u0634\u062a\u0631\u0627\u0643 \u0628\u0646\u062c\u0627\u062d ","success"),this.modalController.dismiss(this.mzd,"done"),this.rout.navigate(["tabs/home"])},t=>{this.loadingController.dismiss(),this.handleError(t.error.error)},()=>{this.loadingController.dismiss()}))}validateAuctionCondition(){1==this.validate()&&(this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0642\u0642 .."),this.api.validateAuctionBeforeSubiscribtion(this.mzd._id).subscribe(t=>{1==t.success?(this.loadingController.dismiss(),this.presentModalWallet()):this.handleError("err")},t=>{this.loadingController.dismiss(),this.handleError(t.error.error)}))}presentModal(t,s){var m=this;return(0,b.Z)(function*(){const g=yield m.modalController.create({component:a.F,componentProps:{mzd:m.mzd,USER_INFO:m.USER_INFO,amount:+m.mzd.fee+m.mzd.deposit}});return g.onDidDismiss().then(A=>{null!==A&&m.doAfterDissmiss(A)}),yield g.present()})()}presentModalWallet(){var t=this;return(0,b.Z)(function*(){const s=yield t.modalController.create({component:Z._,componentProps:{mzd:t.mzd,USER_INFO:t.USER_INFO,amount:+t.mzd.fee+t.mzd.deposit,walletBalance:t.walletBalance}});return s.onDidDismiss().then(m=>{null!==m&&t.doAfterDissmiss(m)}),yield s.present()})()}doAfterDissmissWallet(t){"done"==t.role&&this.rout.navigate(["tabs/wallet"])}doAfterDissmiss(t){"done"==t.role&&this.rout.navigate(["tabs/home"])}handleError(t){this.presentToast("max users"==t?"\u0627\u0643\u062a\u0645\u0644 \u0627\u0644\u0639\u062f\u062f \u0627\u0644\u0645\u0637\u0644\u0648\u0628 , \u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629":"prev cancel trans not done"==t?"\u0644\u062f\u064a\u0643 \u0639\u0645\u0644\u064a\u0629 \u0625\u0631\u062c\u0627\u0639 \u0645\u0628\u0644\u063a \u0644\u0645 \u062a\u0643\u062a\u0645\u0644 , \u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629":"\u062d\u062f\u062b \u062e\u0637\u0623 \u0645\u0627 \u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u0644\u0645\u062d\u0627\u0648\u0644\u0629 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")}presentActionSheet(){var t=this;return(0,b.Z)(function*(){const s=yield t.actionSheetCtl.create({header:"\u062f\u0641\u0639 \u0639\u0628\u0631 \u0627\u0644\u0645\u062d\u0641\u0638\u0629",subHeader:t.walletBalance+"\u0631\u0635\u064a\u062f\u0643 \u0627\u0644\u062d\u0627\u0644\u064a",cssClass:"my-custom-class",mode:"ios",buttons:[{text:"\u0639\u0628\u0631 \u0627\u0644\u0645\u062d\u0641\u0638\u0629"+t.mzd.fee+t.mzd.deposit+"\u062c.\u0633\u062f\u0641\u0639 \u0645\u0628\u0644\u063a ",icon:"wallet",handler:()=>{1==t.mzd.userOut?t.reSubiscribtion():t.subescribe()}},{text:"\u0625\u0644\u063a\u0627\u0621",icon:"close",role:"cancel",handler:()=>{}}]});yield s.present(),yield s.onDidDismiss()})()}presentToast(t,s){var m=this;return(0,b.Z)(function*(){(yield m.toast.create({message:t,duration:2e3,color:s,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})()}}return d.\u0275fac=function(t){return new(t||d)(e.Y36(h.gz),e.Y36(T.D),e.Y36(h.F0),e.Y36(l.HT),e.Y36(l.yF),e.Y36(l.BX),e.Y36(l.IN))},d.\u0275cmp=e.Xpm({type:d,selectors:[["app-mzad-subescribe"]],decls:89,vars:7,consts:[["dir","rtl"],["slot","end"],["dir","rtl",1,"ion-no-margin","ion-no-padding"],[1,"ion-no-padding"],[1,"w100"],["name","cash-outline","color","primary"],["dir","rtl",1,"ion-no-margin","ion-no-padding","ion-padding-bottom"],[1,"ion-no-margin","ion-no-padding"],["size","12",1,"ion-text-center"],[4,"ngFor","ngForOf"],["lines","none"],["color","primary"],["name","bookmark-outline","color","primary"],["size","12"],[3,"ngModel","ngModelChange","ionChange"],[1,"footer"],["size","6"],["button","","color","dark","expand","block","type","outline",1,"custItem","ion-text-center",3,"click"],["size","6",1,"ion-text-center"],[1,"ion-no-margin"],["size","8",1,"ion-text-start","ion-padding"],["color","dark"],["size","4",1,"ion-text-end","ion-padding"],["name","pin","color","primary"]],template:function(t,s){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button"),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"\u0627\u0644\u0625\u0634\u062a\u0631\u0627\u0643 \u0641\u064a \u0645\u0632\u0627\u062f"),e.qZA()()(),e.TgZ(6,"ion-content")(7,"ion-grid",2)(8,"ion-row",3)(9,"ion-card",4)(10,"ion-card-header")(11,"ion-card-title"),e._UZ(12,"ion-icon",5),e._uU(13," \u0627\u0644\u0645\u0646\u062a\u062c\u0627\u062a "),e.qZA()(),e.TgZ(14,"ion-grid",6)(15,"ion-row",7)(16,"ion-col",8)(17,"ion-grid"),e.YNc(18,o,12,3,"ion-row",9),e.qZA()()()()(),e.TgZ(19,"ion-card",4)(20,"ion-card-header")(21,"ion-card-title"),e._UZ(22,"ion-icon",5),e._uU(23," \u0631\u0633\u0648\u0645 \u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629 "),e.qZA()(),e.TgZ(24,"ion-grid",6)(25,"ion-row",7)(26,"ion-col",8)(27,"ion-item",10)(28,"ion-label")(29,"ion-text",11)(30,"b"),e._uU(31,"\u0627\u0644\u0639\u0631\u0628\u0648\u0646"),e.qZA()()(),e.TgZ(32,"ion-label",1)(33,"ion-text"),e._uU(34),e.qZA(),e.TgZ(35,"ion-text"),e._uU(36," \u062c.\u0633"),e.qZA()()()(),e.TgZ(37,"ion-col",8)(38,"ion-item")(39,"ion-label")(40,"ion-text",11)(41,"b"),e._uU(42,"\u0631\u0633\u0648\u0645 \u062f\u0641\u062a\u0631 "),e.qZA()()(),e.TgZ(43,"ion-label",1)(44,"ion-text"),e._uU(45),e.qZA(),e.TgZ(46,"ion-text"),e._uU(47," \u062c.\u0633"),e.qZA()()()(),e.TgZ(48,"ion-col",8)(49,"ion-item",10)(50,"ion-label")(51,"ion-text",11)(52,"b"),e._uU(53,"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 "),e.qZA()()(),e.TgZ(54,"ion-label",1)(55,"ion-text"),e._uU(56),e.qZA(),e.TgZ(57,"ion-text"),e._uU(58," \u062c.\u0633"),e.qZA()()()()()()(),e.TgZ(59,"ion-card",4)(60,"ion-card-header")(61,"ion-card-title"),e._UZ(62,"ion-icon",12),e._uU(63," \u0628\u0646\u0648\u062f \u0627\u0644\u0645\u0632\u0627\u062f "),e.qZA()(),e.TgZ(64,"ion-grid")(65,"ion-row")(66,"ion-col",13)(67,"ion-card-content"),e.YNc(68,r,5,1,"ion-label",9),e.qZA(),e.TgZ(69,"ion-item")(70,"ion-label"),e._uU(71,"\u0623\u0648\u0627\u0641\u0642 \u0639\u0644\u064a \u0627\u0644\u0634\u0631\u0648\u0637 "),e.qZA(),e.TgZ(72,"ion-checkbox",14),e.NdJ("ngModelChange",function(g){return s.agreeTerms=g})("ionChange",function(g){return s.agreeCheck(g)}),e.qZA()()()()()()()()(),e.TgZ(73,"ion-footer",15)(74,"ion-grid",0)(75,"ion-row")(76,"ion-col",16)(77,"ion-item",17),e.NdJ("click",function(){return s.validateAuctionCondition()}),e.TgZ(78,"h5",4),e._uU(79,"\u062f\u0641\u0640\u0640\u0639 "),e.qZA()()(),e.TgZ(80,"ion-col",18)(81,"h4",19)(82,"ion-text",11),e._uU(83," \u0631\u0633\u0648\u0645 \u0627\u0644\u0625\u0634\u062a\u0631\u0627\u0643 "),e.qZA(),e._UZ(84,"br"),e.TgZ(85,"ion-text"),e._uU(86),e.qZA(),e.TgZ(87,"ion-text"),e._uU(88,"usd"),e.qZA()()()()()()),2&t&&(e.xp6(18),e.Q6J("ngForOf",s.mzd.productsList),e.xp6(16),e.hij(" ",s.mzd.deposit," "),e.xp6(11),e.hij(" ",s.mzd.fee," "),e.xp6(11),e.hij(" ",s.mzd.fee+s.mzd.deposit," "),e.xp6(12),e.Q6J("ngForOf",s.mzd.terms),e.xp6(4),e.Q6J("ngModel",s.agreeTerms),e.xp6(14),e.hij(" ",s.mzd.fee+s.mzd.deposit," "))},dependencies:[n.sg,p.JJ,p.On,l.oU,l.Sm,l.PM,l.FN,l.Zi,l.Dq,l.nz,l.wI,l.W2,l.fr,l.jY,l.Gu,l.gu,l.Ie,l.Q$,l.uN,l.Nd,l.yW,l.wd,l.sr,l.w,l.cs],styles:[".footer[_ngcontent-%COMP%]{border-style:solid;border-width:.3px;border-color:var(--ion-color-light-shade);border-top-right-radius:30px;border-top-left-radius:30px}.header-md[_ngcontent-%COMP%]:after{background-image:none}.custItem[_ngcontent-%COMP%]{border-style:solid;border-width:.5px;border-color:var(--ion-color-dark);background-color:var(--ion-color-primary-contrast);border-radius:2rem}.footer-md[_ngcontent-%COMP%]:before{background-image:none}.action-sheet-container[_ngcontent-%COMP%]{direction:rtl}"]}),d})()},7815:(y,f,u)=>{u.d(f,{F:()=>l});var b=u(5861),i=u(529),E=u(2340),a=u(510),Z=u(7224),e=u(6738),h=u(3497),T=u(4338);let l=(()=>{class n{constructor(o,r,c,d,_,t){this.toast=o,this.loadingController=r,this.modalCtrl=c,this.api=d,this.httpClient=_,this.http=t,this.data={},this.apis="https://coral-app-pr5y9.ondigitalocean.app/transactions/subescribestripe",a.hK.initialize({publishableKey:E.N.stripe.publishableKey})}httpPost(o){let r=new i.LE;return r=r.append("data",o),this.http.post(this.apis,o).pipe((0,Z.P)())}closeModel(){this.modalCtrl.dismiss()}ngOnInit(){"order"==this.status?this.prepareOrder():this.prepareTransaction(),this.data={name:this.USER_INFO.fullName,email:this.USER_INFO.email,amount:this.amount,currency:"usd",transaction:this.trasaction}}prepareTransaction(){this.trasaction={_id:"",orderId:"",auctId:this.mzd._id,userId:this.USER_INFO._id,currentStatus:0,typee:1,pay:this.amount,details:"\u0633\u062f\u0627\u062f \u0641\u0627\u062a\u0648\u0631\u0629 \u0625\u0634\u0646\u0631\u0627\u0643 \u0641\u064a \u0645\u0632\u0627\u062f  "+this.mzd.title,comment:"\u0633\u062f\u0627\u062f \u0641\u0627\u062a\u0648\u0631\u0629 \u0625\u0634\u0646\u0631\u0627\u0643 \u0641\u064a \u0645\u0632\u0627\u062f  \u0645\u0646 \u0645\u0632\u0627\u062f : "+this.mzd.title+",\u0631\u0642\u0645: "+this.mzd._id,fromAccount:this.USER_INFO._id,toAccount:"310000205349900001",fromAccountTitle:"\u062d\u0633\u0627\u0628  : "+this.USER_INFO.fullName,toAccountTitle:"\u0634\u0631\u0643\u0629 \u0632\u0648\u0648\u062f\u0647\u0627"}}prepareOrder(){this.trasaction={_id:"",orderId:"",auctId:this.mzd._id,userId:this.USER_INFO._id,currentStatus:0,typee:1,pay:this.amount,details:"\u0633\u062f\u0627\u062f \u0641\u0627\u062a\u0648\u0631\u0629 \u0631\u0642\u0645  "+this.order._id,comment:"\u0633\u062f\u0627\u062f \u0641\u0627\u062a\u0648\u0631\u0629 \u0631\u0642\u0645  "+this.order._id+"\u0645\u0646 \u0645\u0632\u0627\u062f : "+this.order.auctions[0].title+",\u0631\u0642\u0645: "+this.order.auctions[0]._id,fromAccount:this.USER_INFO._id,toAccount:"310000205349900001",fromAccountTitle:"\u062d\u0633\u0627\u0628  : "+this.USER_INFO.firstName,toAccountTitle:"\u0634\u0631\u0643\u0629 \u0632\u0648\u0648\u062f\u0647\u0627"}}prepareUserbj(o){return o?{_id:this.mzd._id,user:[{userId:this.USER_INFO._id,cancel:0,cancelTime:null,reason:"",cancelTransId:""}]}:{_id:this.mzd._id,user:[{userId:this.USER_INFO._id,status:1,time:new Date,cancel:0,cancelTime:"",reason:"",transactionId:""}]}}prepareOrderbj(){return{_id:this.order._id,auctId:this.mzd._id,userId:this.USER_INFO._id,currentStatus:1}}subescribe(){this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u0645\u0639\u0627\u0644\u062c\u0629 \u0637\u0644\u0628\u0643 .."),"order"==this.status?this.api.updateOrderStatus(this.prepareOrderbj()).subscribe(o=>{this.presentToast("\u062a\u0645 \u0627\u0644\u0625\u0634\u062a\u0631\u0627\u0643 \u0628\u0646\u062c\u0627\u062d ","success"),this.modalCtrl.dismiss(this.mzd,"done")},o=>{this.loadingController.dismiss()}):this.api.updateAuctionUsers(this.prepareUserbj()).subscribe(o=>{this.presentToast("\u062a\u0645 \u0627\u0644\u0625\u0634\u062a\u0631\u0627\u0643 \u0628\u0646\u062c\u0627\u062d ","success"),this.modalCtrl.dismiss(this.mzd,"done")},o=>{this.loadingController.dismiss()})}crateTrans(){this.api.createTrans(this.trasaction).subscribe(o=>{this.subescribe()},o=>{this.loadingController.dismiss()})}paymentSheet(){var o=this;return(0,b.Z)(function*(){try{a.hK.addListener(a.YG.Completed,()=>{});const r=o.httpPost(o.data);let c,d,_;yield r.subscribe(m=>{c=m.paymentIntent,d=m.ephemeralKey,_=m.customer}),yield a.hK.createPaymentSheet({paymentIntentClientSecret:c,customerId:_,customerEphemeralKeySecret:d,merchantDisplayName:"zoodoha"}),(yield a.hK.presentPaymentSheet()).paymentResult===a.YG.Completed&&o.crateTrans()}catch{}})()}PaymentFlowSheet(){var o=this;return(0,b.Z)(function*(){try{a.hK.addListener(a.I.Completed,()=>{});const r=o.httpPost(o.data);let c,d,_;yield r.subscribe(g=>{c=g.paymentIntent,d=g.ephemeralKey,_=g.customer}),a.hK.createPaymentFlow({paymentIntentClientSecret:c,merchantDisplayName:"zoodoha",customerEphemeralKeySecret:d,customerId:_}),yield a.hK.presentPaymentFlow(),yield a.hK.confirmPaymentFlow()}catch{}})()}presentLoadingWithOptions(o){var r=this;return(0,b.Z)(function*(){const c=yield r.loadingController.create({spinner:"bubbles",mode:"ios",duration:5e3,message:o,translucent:!0,backdropDismiss:!1});yield c.present(),yield c.onDidDismiss()})()}presentToast(o,r){var c=this;return(0,b.Z)(function*(){(yield c.toast.create({message:o,duration:2e3,color:r,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})()}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(h.yF),e.Y36(h.HT),e.Y36(h.IN),e.Y36(T.D),e.Y36(i.JF),e.Y36(i.eN))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-stripe-payment"]],decls:38,vars:3,consts:[["color","light"],["slot","start"],["fill","clear",3,"click"],["name","close-circle-outline","color","dark"],["dir","rtl"],[1,"ion-margin-top"],["button","",3,"click"],["slot","start","name","card-outline","color","dark"],["slot","end"],["button","","disabled","true",1,"ion-margin-top",3,"click"],["slot","start","name","logo-google","color","danger"],["slot","start","name","logo-apple"]],template:function(o,r){1&o&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),e.NdJ("click",function(){return r.closeModel()}),e._UZ(4,"ion-icon",3),e.qZA()(),e._UZ(5,"ion-title"),e.qZA()(),e.TgZ(6,"ion-content",4)(7,"ion-list",5)(8,"ion-item",6),e.NdJ("click",function(){return r.paymentSheet()}),e._UZ(9,"ion-icon",7),e.TgZ(10,"ion-label"),e._uU(11,"\u062f\u0641\u0639 \u0639\u0628\u0631 \u0627\u0644\u0628\u0637\u0627\u0642\u0629 "),e.qZA(),e.TgZ(12,"ion-label",8)(13,"ion-note"),e._uU(14,"usd"),e.qZA(),e._uU(15," \xa0"),e.TgZ(16,"ion-text"),e._uU(17),e.qZA()()(),e.TgZ(18,"ion-item",9),e.NdJ("click",function(){return r.paymentSheet()}),e._UZ(19,"ion-icon",10),e.TgZ(20,"ion-label"),e._uU(21," \u062f\u0641\u0639 \u0639\u0628\u0631 \u0642\u0648\u0642\u0644 \u0628\u0627\u064a "),e.qZA(),e.TgZ(22,"ion-label",8)(23,"ion-note"),e._uU(24,"usd"),e.qZA(),e._uU(25," \xa0 "),e.TgZ(26,"ion-text"),e._uU(27),e.qZA()()(),e.TgZ(28,"ion-item",9),e.NdJ("click",function(){return r.paymentSheet()}),e._UZ(29,"ion-icon",11),e.TgZ(30,"ion-label"),e._uU(31," \u062f\u0641\u0639 \u0639\u0628\u0631 \u0627\u0628\u0644 \u0628\u0627\u064a "),e.qZA(),e.TgZ(32,"ion-label",8)(33,"ion-note"),e._uU(34,"usd"),e.qZA(),e._uU(35," \xa0 "),e.TgZ(36,"ion-text"),e._uU(37),e.qZA()()()()()),2&o&&(e.xp6(17),e.Oqu(r.amount),e.xp6(10),e.Oqu(r.amount),e.xp6(10),e.Oqu(r.amount))},dependencies:[h.YG,h.Sm,h.W2,h.Gu,h.gu,h.Ie,h.Q$,h.q_,h.uN,h.yW,h.wd,h.sr],styles:[".header-md[_ngcontent-%COMP%]:after{background-image:none}"]}),n})()},3594:(y,f,u)=>{u.d(f,{_:()=>h});var b=u(5861),i=u(6738),E=u(849),a=u(3497),Z=u(4338),e=u(529);let h=(()=>{class T{constructor(n,p,o,r,c,d,_,t){this.storage=n,this.modalController=p,this.toast=o,this.loadingController=r,this.modalCtrl=c,this.api=d,this.httpClient=_,this.http=t,this.data={},this.appInfoArr=[]}ngOnInit(){console.log(this.amount,this.walletBalance),this.getAppInfo(),this.prepareTransaction()}getAppInfo(){this.storage.get("APPINFO").then(n=>{n&&(console.log(n),this.appInfoArr=n)})}closeModel(){this.modalCtrl.dismiss()}prepareTransaction(){this.transaction={_id:"",orderId:"",auctId:this.mzd._id,userId:this.USER_INFO._id,currentStatus:0,typee:1,pay:this.amount+this.amount*(+this.mzd.vatFee/100),details:"\u0633\u062f\u0627\u062f \u0631\u0633\u0648\u0645 \u0625\u0634\u062a\u0631\u0627\u0643 \u0641\u064a \u0645\u0632\u0627\u062f "+this.mzd.titleEn,comment:"",fromAccount:"",toAccount:"",fromAccountTitle:"",toAccountTitle:"",paymentMethod:"\u0645\u062d\u0641\u0638\u0629 \u062a\u0637\u0628\u064a\u0642  "+this.appInfoArr.appName,detailsEn:"pay auction's subescribtion fees  "+this.mzd.titleEn,taxId:this.appInfoArr[0].taxId,vatFee:this.mzd.vatFee,vatOrder:this.mzd.vatOrder},console.log("pre",this.transaction)}prepareUserbj(n){return{_id:this.mzd._id,user:[{userId:this.USER_INFO._id,status:1,time:new Date,cancel:0,cancelTime:"",reason:"",transactionId:""}]}}crateTrans(){this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u0645\u0639\u0627\u0644\u062c\u0629 \u0637\u0644\u0628\u0643 .."),console.log("pre",this.transaction),this.api.createTrans(this.transaction).subscribe(n=>{console.log(n),this.subescribe()},n=>{this.handleError(n),this.loadingController.dismiss(),console.log(n)})}subescribe(){this.api.updateAuctionUsers(this.prepareUserbj()).subscribe(n=>{this.mzd.users=n.updatedAuctionUsers.users,this.loadingController.dismiss(),this.presentToast("\u062a\u0645 \u0627\u0644\u0625\u0634\u062a\u0631\u0627\u0643 \u0628\u0646\u062c\u0627\u062d ","success"),this.modalController.dismiss(this.mzd,"done")},n=>{this.handleError(n.error.error)},()=>{this.loadingController.dismiss()})}handleError(n){this.presentToast("max users"==n?"\u0627\u0643\u062a\u0645\u0644 \u0627\u0644\u0639\u062f\u062f \u0627\u0644\u0645\u0637\u0644\u0648\u0628 , \u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629":"prev cancel trans not done"==n?"\u0644\u062f\u064a\u0643 \u0639\u0645\u0644\u064a\u0629 \u0625\u0631\u062c\u0627\u0639 \u0645\u0628\u0644\u063a \u0644\u0645 \u062a\u0643\u062a\u0645\u0644 , \u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629":"\u062d\u062f\u062b \u062e\u0637\u0623 \u0645\u0627 \u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u0644\u0645\u062d\u0627\u0648\u0644\u0629 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")}presentLoadingWithOptions(n){var p=this;return(0,b.Z)(function*(){const o=yield p.loadingController.create({spinner:"bubbles",mode:"ios",duration:5e3,message:n,translucent:!0,backdropDismiss:!1});yield o.present(),yield o.onDidDismiss()})()}presentToast(n,p){var o=this;return(0,b.Z)(function*(){(yield o.toast.create({message:n,duration:2e3,color:p,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})()}}return T.\u0275fac=function(n){return new(n||T)(i.Y36(E.K),i.Y36(a.IN),i.Y36(a.yF),i.Y36(a.HT),i.Y36(a.IN),i.Y36(Z.D),i.Y36(e.JF),i.Y36(e.eN))},T.\u0275cmp=i.Xpm({type:T,selectors:[["app-subiscribe-wallet"]],decls:32,vars:2,consts:[["color","light"],["slot","start"],["fill","clear",3,"click"],["name","close-circle-outline","color","danger"],["dir","rtl",1,"mg50"],["size","12",1,"ion-text-center"],[1,"ion-justify-content-center"],["size","8",1,"ion-text-center"],["button","","color","dark","expand","block","type","outline",1,"custItem","ion-text-center",3,"click"],[1,"w100"],["name","wallet-outline","color","light","slot","start"]],template:function(n,p){1&n&&(i.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),i.NdJ("click",function(){return p.closeModel()}),i._UZ(4,"ion-icon",3),i.qZA()(),i._UZ(5,"ion-title"),i.qZA()(),i.TgZ(6,"ion-content")(7,"ion-grid",4)(8,"ion-row")(9,"ion-col",5)(10,"h4")(11,"ion-label")(12,"b"),i._uU(13," \u062f\u0641\u0639 \u0639\u0628\u0631 \u0627\u0644\u0645\u062d\u0641\u0638\u0629 "),i.qZA()(),i._UZ(14,"br"),i.TgZ(15,"ion-text"),i._uU(16," \u0631\u0635\u064a\u062f\u0643 \u0627\u0644\u062d\u0627\u0644\u064a : "),i.qZA(),i.TgZ(17,"ion-label"),i._uU(18),i.qZA(),i.TgZ(19,"ion-note"),i._uU(20," sd"),i.qZA()()(),i.TgZ(21,"ion-col",5),i._UZ(22,"h5"),i.qZA()(),i.TgZ(23,"ion-row",6)(24,"ion-col",7)(25,"ion-item",8),i.NdJ("click",function(){return p.crateTrans()}),i.TgZ(26,"h5",9)(27,"ion-label"),i._uU(28),i.TgZ(29,"ion-note",0),i._uU(30," sd"),i.qZA()()(),i._UZ(31,"ion-icon",10),i.qZA()()()()()),2&n&&(i.xp6(18),i.hij("",p.walletBalance," "),i.xp6(10),i.hij(" \u062f\u0641\u0639 \u0645\u0628\u0644\u063a ",p.amount," "))},dependencies:[a.YG,a.Sm,a.wI,a.W2,a.jY,a.Gu,a.gu,a.Ie,a.Q$,a.uN,a.Nd,a.yW,a.wd,a.sr],styles:[".custItem[_ngcontent-%COMP%]{border-style:solid;border-width:.5px;border-color:var(--ion-color-dark);background-color:var(--ion-color-primary-contrast);border-radius:2rem}.mg50[_ngcontent-%COMP%]{margin-top:50%}"]}),T})()}}]);