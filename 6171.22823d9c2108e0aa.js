"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6171],{6171:(A,c,i)=>{i.r(c),i.d(c,{SubiscribeWalletPageModule:()=>d});var u=i(6895),t=i(4006),m=i(3497),o=i(2485),p=i(3594),r=i(6738);const g=[{path:"",component:p._}];let a=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[o.Bz.forChild(g),o.Bz]}),e})(),d=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[u.ez,t.u5,m.Pc,a]}),e})()},3594:(A,c,i)=>{i.d(c,{_:()=>g});var u=i(5861),t=i(6738),m=i(849),o=i(3497),p=i(4338),r=i(529);let g=(()=>{class a{constructor(e,s,n,l,h,b,_,T){this.storage=e,this.modalController=s,this.toast=n,this.loadingController=l,this.modalCtrl=h,this.api=b,this.httpClient=_,this.http=T,this.data={},this.appInfoArr=[]}ngOnInit(){console.log(this.amount,this.walletBalance),this.getAppInfo(),this.prepareTransaction()}getAppInfo(){this.storage.get("APPINFO").then(e=>{e&&(console.log(e),this.appInfoArr=e)})}closeModel(){this.modalCtrl.dismiss()}prepareTransaction(){this.transaction={_id:"",orderId:"",auctId:this.mzd._id,userId:this.USER_INFO._id,currentStatus:0,typee:1,pay:this.amount+this.amount*(+this.mzd.vatFee/100),details:"\u0633\u062f\u0627\u062f \u0631\u0633\u0648\u0645 \u0625\u0634\u062a\u0631\u0627\u0643 \u0641\u064a \u0645\u0632\u0627\u062f "+this.mzd.titleEn,comment:"",fromAccount:"",toAccount:"",fromAccountTitle:"",toAccountTitle:"",paymentMethod:"\u0645\u062d\u0641\u0638\u0629 \u062a\u0637\u0628\u064a\u0642  "+this.appInfoArr.appName,detailsEn:"pay auction's subescribtion fees  "+this.mzd.titleEn,taxId:this.appInfoArr[0].taxId,vatFee:this.mzd.vatFee,vatOrder:this.mzd.vatOrder},console.log("pre",this.transaction)}prepareUserbj(e){return{_id:this.mzd._id,user:[{userId:this.USER_INFO._id,status:1,time:new Date,cancel:0,cancelTime:"",reason:"",transactionId:""}]}}crateTrans(){this.presentLoadingWithOptions("\u062c\u0627\u0631\u064a \u0645\u0639\u0627\u0644\u062c\u0629 \u0637\u0644\u0628\u0643 .."),console.log("pre",this.transaction),this.api.createTrans(this.transaction).subscribe(e=>{console.log(e),this.subescribe()},e=>{this.handleError(e),this.loadingController.dismiss(),console.log(e)})}subescribe(){this.api.updateAuctionUsers(this.prepareUserbj()).subscribe(e=>{this.mzd.users=e.updatedAuctionUsers.users,this.loadingController.dismiss(),this.presentToast("\u062a\u0645 \u0627\u0644\u0625\u0634\u062a\u0631\u0627\u0643 \u0628\u0646\u062c\u0627\u062d ","success"),this.modalController.dismiss(this.mzd,"done")},e=>{this.handleError(e.error.error)},()=>{this.loadingController.dismiss()})}handleError(e){this.presentToast("max users"==e?"\u0627\u0643\u062a\u0645\u0644 \u0627\u0644\u0639\u062f\u062f \u0627\u0644\u0645\u0637\u0644\u0648\u0628 , \u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629":"prev cancel trans not done"==e?"\u0644\u062f\u064a\u0643 \u0639\u0645\u0644\u064a\u0629 \u0625\u0631\u062c\u0627\u0639 \u0645\u0628\u0644\u063a \u0644\u0645 \u062a\u0643\u062a\u0645\u0644 , \u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629":"\u062d\u062f\u062b \u062e\u0637\u0623 \u0645\u0627 \u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u0644\u0645\u062d\u0627\u0648\u0644\u0629 \u0645\u0631\u0629 \u0627\u062e\u0631\u064a","danger")}presentLoadingWithOptions(e){var s=this;return(0,u.Z)(function*(){const n=yield s.loadingController.create({spinner:"bubbles",mode:"ios",duration:5e3,message:e,translucent:!0,backdropDismiss:!1});yield n.present(),yield n.onDidDismiss()})()}presentToast(e,s){var n=this;return(0,u.Z)(function*(){(yield n.toast.create({message:e,duration:2e3,color:s,cssClass:"cust_Toast",mode:"ios",position:"top"})).present()})()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(m.K),t.Y36(o.IN),t.Y36(o.yF),t.Y36(o.HT),t.Y36(o.IN),t.Y36(p.D),t.Y36(r.JF),t.Y36(r.eN))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-subiscribe-wallet"]],decls:32,vars:2,consts:[["color","light"],["slot","start"],["fill","clear",3,"click"],["name","close-circle-outline","color","danger"],["dir","rtl",1,"mg50"],["size","12",1,"ion-text-center"],[1,"ion-justify-content-center"],["size","8",1,"ion-text-center"],["button","","color","dark","expand","block","type","outline",1,"custItem","ion-text-center",3,"click"],[1,"w100"],["name","wallet-outline","color","light","slot","start"]],template:function(e,s){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),t.NdJ("click",function(){return s.closeModel()}),t._UZ(4,"ion-icon",3),t.qZA()(),t._UZ(5,"ion-title"),t.qZA()(),t.TgZ(6,"ion-content")(7,"ion-grid",4)(8,"ion-row")(9,"ion-col",5)(10,"h4")(11,"ion-label")(12,"b"),t._uU(13," \u062f\u0641\u0639 \u0639\u0628\u0631 \u0627\u0644\u0645\u062d\u0641\u0638\u0629 "),t.qZA()(),t._UZ(14,"br"),t.TgZ(15,"ion-text"),t._uU(16," \u0631\u0635\u064a\u062f\u0643 \u0627\u0644\u062d\u0627\u0644\u064a : "),t.qZA(),t.TgZ(17,"ion-label"),t._uU(18),t.qZA(),t.TgZ(19,"ion-note"),t._uU(20," sd"),t.qZA()()(),t.TgZ(21,"ion-col",5),t._UZ(22,"h5"),t.qZA()(),t.TgZ(23,"ion-row",6)(24,"ion-col",7)(25,"ion-item",8),t.NdJ("click",function(){return s.crateTrans()}),t.TgZ(26,"h5",9)(27,"ion-label"),t._uU(28),t.TgZ(29,"ion-note",0),t._uU(30," sd"),t.qZA()()(),t._UZ(31,"ion-icon",10),t.qZA()()()()()),2&e&&(t.xp6(18),t.hij("",s.walletBalance," "),t.xp6(10),t.hij(" \u062f\u0641\u0639 \u0645\u0628\u0644\u063a ",s.amount," "))},dependencies:[o.YG,o.Sm,o.wI,o.W2,o.jY,o.Gu,o.gu,o.Ie,o.Q$,o.uN,o.Nd,o.yW,o.wd,o.sr],styles:[".custItem[_ngcontent-%COMP%]{border-style:solid;border-width:.5px;border-color:var(--ion-color-dark);background-color:var(--ion-color-primary-contrast);border-radius:2rem}.mg50[_ngcontent-%COMP%]{margin-top:50%}"]}),a})()}}]);